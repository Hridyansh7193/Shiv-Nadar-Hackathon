name: ğŸ›¡ï¸ Sentinel Source Security Scan

on:
  push:
    branches: [main, swastika]
  pull_request:
    branches: [main]

jobs:
  security-scan:
    name: Scan Dependencies
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout Code
        uses: actions/checkout@v3

      - name: ğŸ Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: ğŸ“¦ Install Dependencies
        run: pip install httpx python-dotenv

      - name: ğŸ” Run Sentinel Source Scan
        env:
          SENTINEL_API_URL: ${{ secrets.SENTINEL_API_URL }}
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
        run: |
          python backend/services/cicd_scanner.py sentinel-source/package.json

      - name: âœ… Build Passed
        if: success()
        run: echo "ğŸŸ¢ All dependencies safe!"

      - name: âŒ Build Failed
        if: failure()
        run: echo "ğŸ”´ High risk detected â€” build blocked!"